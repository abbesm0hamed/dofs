---
- name: Verify Key Binaries
  command: "command -v {{ item }}"
  loop:
    - niri
    - waybar
    - mako
    - rofi
    - xwayland-satellite
    - hyprlock
    - swayidle
    - wezterm
    - fnm
    - bun
    - rustup
    - python
    - tailscale
    - docker
    - rclone
  changed_when: false

- name: Check Configuration Files
  stat:
    path: "{{ ansible_user_dir }}/{{ item }}"
  loop:
    - .config/niri/config.kdl
    - .config/waybar/config.jsonc
    - .config/mako/config
    - .config/helix/config.toml
  register: config_stats

- name: Verify Configuration Files Exist
  assert:
    that: item.stat.exists
    fail_msg: "Config file {{ item.item }} is missing from {{ ansible_user_dir }}/"
  loop: "{{ config_stats.results }}"
  loop_control:
    label: "{{ item.item }}"

- name: Verify Service Status
  systemd:
    name: "{{ item }}"
    state: started
  loop:
    - firewalld
    - docker
    - libvirtd
  ignore_errors: true
  changed_when: false
